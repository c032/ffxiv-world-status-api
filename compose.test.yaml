version: "3.8"

services:
  postgresql:
    environment:
      - "PGDATA=/var/lib/postgresql/data/pgdata"
      - "POSTGRES_DB=test_website"
      - "POSTGRES_HOST_AUTH_METHOD=scram-sha-256"
      - "POSTGRES_INITDB_ARGS=--no-locale --data-checksums --auth-host=scram-sha-256"
      - "POSTGRES_PASSWORD=correct horse battery staple"
      - "POSTGRES_USER=test_website"
    image: "postgres:16.1-alpine3.19"
    volumes:
      - "./migrations:/docker-entrypoint-initdb.d"
      - "postgresql_data_test:/var/lib/postgresql/data/pgdata"

  api-e2e:
    build:
      context: "."
      dockerfile: "Dockerfile-e2e"
    depends_on:
      - "postgresql"
    environment:
      - "POSTGRESQL_CONNECTION_STRING_FILE=/usr/local/etc/api.c032.dev/postgresql_connection_string"
      - "PORT=8000"
    links:
      - "postgresql:postgresql"
    volumes:
      - "./docker/postgresql_connection_string:/usr/local/etc/api.c032.dev/postgresql_connection_string"

volumes:
  postgresql_data_test:
